<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='stylesheet/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <title>Booking Page</title>
</head>
<body>
<div id="header">
    <nav id="navbar">
        <ul id="menu">
            <li>
                <a href="{{ url_for('index_view') }}" style="text-decoration: none;color: #000;">
                    Home
                </a>
            </li>
            <li>
                <a href="{{ url_for('about_view') }}" style="text-decoration: none;color: #000;">
                    About
                </a>
            </li>
        </ul>
    </nav>
</div>
<div id="main">
    <div class="container">
        <div class="box">
            <div class="content">
                <div class="text-center">
                    <h2 style="font-weight: bold;">
                        BOOK IT NOW !
                    </h2>
                    <p>
                        Pengalaman Luar Biasa Bersama Kami
                    </p>
                </div>
                <br>
                <form action="{{ url_for('booking_create') }}" method="post">
                    <div class="row">
                        <div class="col">
                            <label for="nama" class="form-label">Nama</label>
                            <input type="text" class="form-control" id="nama" name="nama_penanggungjawab" placeholder=""
                                   required>
                        </div>
                        <div class="col">
                            <label for="nama-perusahaan" class="form-label">Nama Perusahaan</label>
                            <input type="text" class="form-control" list="nama-org" id="nama-perusahaan"
                                   name="nama_organisasi" placeholder="cari disini ..." required>
                            <datalist id="nama-org">
                                {% for org in orgs %}
                                    <option value="{{ org.nama_organisasi }}"></option>
                                {% endfor %}
                            </datalist>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col">
                            <label for="email" class="form-label">Email address</label>
                            <input type="email" class="form-control" name="email" id="email"
                                   placeholder="name@example.com" required>
                        </div>
                        <div class="col">
                            <label for="Nomor-Telepon" class="form-label">Nomor Telepon</label>
                            <input type="tel" class="form-control" name="nomor_telepon" id="nomor-telepon"
                                   placeholder="0123456789" required>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col">
                            <label for="start-date" class="form-label">Mulai tanggal</label>
                            <input type="date" id="start-date" name="start_date" class="form-control"
                                   placeholder="DD/MM/YYYY" required>
                        </div>
                        <div class="col">
                            <label for="end-date" class="form-label">Sampai tanggal</label>
                            <input type="date" id="end-date" name="end_date" class="form-control"
                                   placeholder="DD/MM/YYYY" required>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col">
                            <label for="start-time" class="form-label">Jam Mulai</label>
                            <input type="time" id="start-time" name="start_time" min="00:00" max="23:00"
                                   class="form-control" required>
                        </div>
                        <div class="col">
                            <label for="end-time" class="form-label">Jam Berakhir</label>
                            <input type="time" id="end-time" name="end_time" min="00:00" max="23:00"
                                   class="form-control" required>
                        </div>
                    </div>
                    <br>
                    <label for="gedung" class="form-label">Gedung</label>
                    <select class="form-select" id="gedung" name="gedung_id" aria-label="Default select example"
                            required>
                        <option selected value="">Pilih disini ...</option>
                        {% for gedung in gedungs %}
                            <option value="{{ gedung.id }}">{{ gedung.nama }}</option>
                        {% endfor %}
                    </select>
                    <br>
                    <label for="Harga" class="form-label">Harga</label>
                    <input type="email" class="form-control" id="Harga" placeholder="" readonly>
                    <br>
                    <div class="text-center" style="padding:10px ;">
                        <input type="submit" class="button" style="font-weight:bold;" value="BOOKING"/>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- <div id="footer"></div> -->

<!-- Optional JavaScript; choose one of the two! -->

<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

<script type="text/javascript">
    let navbar = document.getElementById("navbar");
    let menu = document.getElementById("menu");

    window.onscroll = function () {
        if (window.pageYOffset > 10) {
            navbar.classList.add("sticky");
        } else {
            navbar.classList.remove("sticky");
        }
    }

    Date.prototype.addHours = function (h) {
        'use strict';
        this.setHours(this.getHours() + h)
        return this;
    }

    Date.prototype.toISO8601TimeString = function (useSeconds) {
        'use strict';
        let hours = this.getHours();
        let minutes = this.getMinutes();
        let seconds = this.getSeconds();
        if (hours < 10) {
            hours = `0${hours}`
        }
        if (minutes < 10) {
            minutes = `0${minutes}`
        }
        if (seconds < 10) {
            seconds = `0${seconds}`
        }
        if (useSeconds) {
            return `${hours}:${minutes}:${seconds}`
        } else {
            return `${hours}:${minutes}`
        }
    }

    Date.prototype.toISO8601DateString = function () {
        'use strict';
        let month = this.getMonth() + 1;
        let date = this.getDate();
        if (month < 10) {
            month = `0${month}`
        }
        if (date < 10) {
            date = `0${date}`
        }

        return `${this.getFullYear()}-${month}-${date}`
    }


    let today = new Date();
    let startTime = today.toISO8601TimeString(false);
    let startDate = document.getElementById("start-date");
    let endDate = document.getElementById("end-date");
    let addHours = today.addHours(1).toISO8601TimeString(false);
    let date_string = today.toISO8601DateString();

    startDate.onchange = () => {
        if (startDate.value == today.toISO8601DateString()) {
            document.getElementById("start-time").setAttribute("min", startTime);
        }
        document.getElementById("end-date").setAttribute("min", startDate.value);
    }

    endDate.onchange = () => {
        if (endDate.value == today.toISO8601DateString()) {
            document.getElementById("end-time").setAttribute("min", addHours);
        }

    }
    document.getElementById("start-date").setAttribute("min", date_string);
    document.getElementById("end-date").setAttribute("min", date_string);

    const namaPerusahaanElem = document.getElementById('nama-perusahaan');
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            const responseText = xhr.responseText
            const json = JSON.parse(responseText)
            document.getElementById('nomor-telepon').value = json['phone']
            document.getElementById('email').value = json['email']
            document.getElementById('nomor-telepon').readOnly = true
            document.getElementById('email').readOnly = true
        } else if (xhr.status === 404) {
            console.log('not found');
            document.getElementById('nomor-telepon').value = ''
            document.getElementById('email').value = ''
            document.getElementById('nomor-telepon').readOnly = false
            document.getElementById('email').readOnly = false
        }
    }

    namaPerusahaanElem.onchange = (ev) => {
        if (namaPerusahaanElem.value !== '') {
            xhr.open('post', '/_/getcompanymp')
            const formData = new FormData()
            formData.append('orgname', namaPerusahaanElem.value)
            xhr.send(formData)
        }
    }


    // document.getElementById("end-time").setAttribute("min", endTime);

    // Javascript has terrible Date API's.
</script>

<!-- Option 2: Separate Popper and Bootstrap JS -->
<!--
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
-->
</body>
</html>